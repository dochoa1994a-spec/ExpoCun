<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Juego EBITDA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    /* Animaciones pequeÃ±as */
    .fade-in {
      animation: fadeIn 0.4s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(6px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .shake {
      animation: shake 0.25s ease-in-out;
    }
    @keyframes shake {
      0%   { transform: translateX(0); }
      25%  { transform: translateX(-4px); }
      50%  { transform: translateX(4px); }
      75%  { transform: translateX(-3px); }
      100% { transform: translateX(0); }
    }

    /* Overlay final tipo alerta */
    .final-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.92);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .final-box {
      background: #020617;
      border-radius: 18px;
      padding: 24px 28px;
      max-width: 420px;
      width: 90%;
      text-align: center;
      box-shadow: 0 20px 45px rgba(0,0,0,0.6);
      animation: popIn 0.4s ease-out;
    }

    .final-emoji {
      font-size: 52px;
      margin-bottom: 8px;
    }

    .final-title {
      font-size: 22px;
      margin: 0 0 6px;
    }

    .final-text {
      font-size: 15px;
      color: #cbd5f5;
      margin-bottom: 16px;
      white-space: pre-line; /* respeta saltos de lÃ­nea en el texto */
    }

    .final-btn {
      border: none;
      border-radius: 999px;
      padding: 10px 18px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      background: #22c55e;
      color: #020617;
      box-shadow: 0 0 0 1px #16a34a;
    }
    .final-btn:hover {
      background: #4ade80;
    }

    @keyframes popIn {
      0%   { transform: scale(0.7); opacity: 0; }
      60%  { transform: scale(1.05); opacity: 1; }
      100% { transform: scale(1); }
    }

    /* Estilos generales del juego */
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
    }
    .game-card {
      background: #020617;
      border-radius: 16px;
      padding: 24px 28px;
      max-width: 700px;
      width: 100%;
      box-shadow: 0 20px 40px rgba(15,23,42,0.7);
    }
    .tag {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      background: #22c55e22;
      color: #22c55e;
      margin-bottom: 6px;
    }
    h1 {
      font-size: 24px;
      margin: 0 0 4px;
    }
    .subtitle {
      font-size: 14px;
      color: #9ca3af;
      margin-bottom: 18px;
    }
    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      font-size: 14px;
      color: #9ca3af;
      gap: 8px;
    }
    .progress {
      flex: 1;
      height: 8px;
      background: #1f2937;
      border-radius: 999px;
      overflow: hidden;
    }
    .progress-inner {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg,#22c55e,#a3e635);
      transition: width 0.3s ease-out;
    }
    .question-box {
      margin: 18px 0;
      padding: 18px;
      border-radius: 12px;
      background: #020617;
      border: 1px solid #1f2937;
    }
    .question-label {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #64748b;
      margin-bottom: 4px;
    }
    .question-text {
      font-size: 20px;
      font-weight: 600;
      color: #e5e7eb;
    }
    .buttons {
      display: flex;
      gap: 12px;
      margin-top: 16px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    button {
      flex: 1;
      padding: 10px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: transform 0.08s ease-out, box-shadow 0.1s ease-out, background 0.15s;
    }
    button:active {
      transform: scale(0.97);
    }
    .btn-yes {
      background: #16a34a;
      color: white;
      box-shadow: 0 0 0 1px #15803d;
    }
    .btn-yes:hover {
      background: #22c55e;
    }
    .btn-no {
      background: #ef4444;
      color: white;
      box-shadow: 0 0 0 1px #b91c1c;
    }
    .btn-no:hover {
      background: #f97373;
    }
    .feedback {
      min-height: 52px;
      font-size: 14px;
      border-radius: 10px;
      padding: 10px 12px;
      background: #020617;
      border: 1px dashed #374151;
      display: flex;
      align-items: center;
    }
    .feedback.correct {
      border-color: #22c55e;
      background: #022c22;
      color: #bbf7d0;
    }
    .feedback.wrong {
      border-color: #f97316;
      background: #451a03;
      color: #fed7aa;
    }
    .hidden {
      display: none;
    }

    @media (max-width: 600px) {
      .game-card {
        padding: 20px 18px;
      }
      .question-text {
        font-size: 18px;
      }
      button {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="game-card">
    <div class="tag">Juego interactivo</div>
    <h1>Â¿Esta partida cuenta para el EBITDA?</h1>
    <p class="subtitle">
      Voten levantando la mano por <b>SÃ­</b> o <b>No</b>. TÃº confirmas desde el computador.
    </p>

    <div class="status-bar">
      <span>Puntos: <span id="score">0</span></span>
      <div class="progress">
        <div id="progress-inner" class="progress-inner"></div>
      </div>
      <span id="counter">0 / 0</span>
    </div>

    <div class="question-box">
      <div class="question-label">Partida del estado de resultados</div>
      <div id="question-text" class="question-text">Cargandoâ€¦</div>

      <div class="buttons">
        <button class="btn-yes" onclick="answer(true)">âœ” SÃ­ cuenta para el EBITDA</button>
        <button class="btn-no" onclick="answer(false)">âœ– No cuenta para el EBITDA</button>
      </div>

      <div id="feedback" class="feedback">
        Toca un botÃ³n para responder.
      </div>
    </div>
  </div>

  <!-- Overlay final de resultado -->
  <div id="final-overlay" class="final-overlay hidden">
    <div class="final-box">
      <div id="final-emoji" class="final-emoji">ðŸ”¥</div>
      <h2 id="final-title" class="final-title">Â¡EBITDA MASTER!</h2>
      <p id="final-text" class="final-text">
        Texto de resultadoâ€¦
      </p>
      <button class="final-btn" onclick="restartGame()">
        Jugar de nuevo
      </button>
    </div>
  </div>

  <!-- Sonidos (puedes cambiar las URLs por tus archivos locales si quieres) -->
  <audio id="sound-correct" src="https://cdn.jsdelivr.net/gh/eddi-assets/audio/correct-soft.mp3"></audio>
  <audio id="sound-wrong"   src="https://cdn.jsdelivr.net/gh/eddi-assets/audio/wrong-soft.mp3"></audio>

  <!-- Confetti (se carga ANTES de usarlo) -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <script>
    const questions = [
      {
        text: "Ingresos operacionales por ventas",
        isEbitda: true,
        explanation: "âœ” SÃ­. Es el punto de partida para calcular el EBITDA."
      },
      {
        text: "Costo de ventas / costo de los servicios",
        isEbitda: true,
        explanation: "âœ” SÃ­. Es un costo operativo, afecta el margen operativo."
      },
      {
        text: "Gastos administrativos (sueldos, arriendo oficina, etc.)",
        isEbitda: true,
        explanation: "âœ” SÃ­. Son gastos operativos antes de depreciaciÃ³n."
      },
      {
        text: "DepreciaciÃ³n y amortizaciÃ³n",
        isEbitda: false,
        explanation: "âœ– No. Precisamente el EBITDA es ANTES de depreciaciÃ³n y amortizaciÃ³n."
      },
      {
        text: "Gasto por intereses del crÃ©dito bancario",
        isEbitda: false,
        explanation: "âœ– No. El EBITDA es antes de intereses (financiaciÃ³n)."
      },
      {
        text: "Impuesto de renta",
        isEbitda: false,
        explanation: "âœ– No. El EBITDA es antes de impuestos."
      },
      {
        text: "Ingreso por interÃ©s ganado sobre inversiones financieras",
        isEbitda: false,
        explanation: "âœ– No. Es ingreso financiero, no operativo del negocio principal."
      },
      {
        text: "Ganancia por venta de un activo fijo (ej. una mÃ¡quina)",
        isEbitda: false,
        explanation: "âœ– No. Es un resultado no recurrente / no operativo."
      },
      {
        text: "Gasto de mercadeo y publicidad",
        isEbitda: true,
        explanation: "âœ” SÃ­. Es un gasto operativo corriente."
      },
      {
        text: "Multa extraordinaria por una demanda",
        isEbitda: false,
        explanation: "âœ– No. Suele tratarse como gasto no operativo / extraordinario."
      }
    ];

    let currentIndex = 0;
    let score = 0;

    // â±ï¸ Tiempo que queda visible la explicaciÃ³n (ms)
    const FEEDBACK_DELAY = 4000; // 4 segundos

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function updateUI() {
      const q = questions[currentIndex];
      document.getElementById("question-text").textContent = q.text;
      document.getElementById("counter").textContent =
        (currentIndex + 1) + " / " + questions.length;
      document.getElementById("score").textContent = score;

      const progress = (currentIndex / questions.length) * 100;
      document.getElementById("progress-inner").style.width = progress + "%";
    }

    function answer(userSaysEbitda) {
      const q = questions[currentIndex];
      const feedback = document.getElementById("feedback");

      feedback.classList.remove("correct", "wrong", "shake");

      const soundCorrect = document.getElementById("sound-correct");
      const soundWrong   = document.getElementById("sound-wrong");

      if (userSaysEbitda === q.isEbitda) {
        score++;
        feedback.classList.add("correct");
        feedback.textContent = "Correcto. " + q.explanation;

        // ðŸ”Š sonido suave
        if (soundCorrect) {
          soundCorrect.volume = 0.25;
          soundCorrect.currentTime = 0;
          soundCorrect.play().catch(() => {});
        }

        // ðŸŽ‰ confetti (si estÃ¡ disponible)
        if (typeof confetti !== "undefined") {
          confetti({
            particleCount: 80,
            spread: 60,
            origin: { y: 0.6 }
          });
        }

      } else {
        feedback.classList.add("wrong", "shake");
        feedback.textContent = "ðŸ¥º No exactamenteâ€¦ " + q.explanation;

        // ðŸ”Š sonido suave de error
        if (soundWrong) {
          soundWrong.volume = 0.25;
          soundWrong.currentTime = 0;
          soundWrong.play().catch(() => {});
        }
      }

      currentIndex++;

      if (currentIndex < questions.length) {
        setTimeout(() => {
          feedback.classList.remove("correct", "wrong", "shake");
          feedback.textContent = "Â¿Cuenta o no cuenta para el EBITDA?";

          // Fade-in para la nueva pregunta
          const box = document.querySelector(".question-box");
          box.classList.add("fade-in");
          setTimeout(() => {
            box.classList.remove("fade-in");
          }, 400);

          updateUI();
        }, FEEDBACK_DELAY);
      } else {
        document.getElementById("progress-inner").style.width = "100%";
        showFinalMessage();
      }
    }

    function showFinalMessage() {
      const overlay = document.getElementById("final-overlay");
      const emojiEl = document.getElementById("final-emoji");
      const titleEl = document.getElementById("final-title");
      const textEl  = document.getElementById("final-text");

      const total = questions.length;
      const ratio = score / total;
      let emoji, title, text;

      if (ratio === 1) {
        emoji = "ðŸ”¥";
        title = "Â¡EBITDA MASTER!";
        text = `Perfecto: ${score}/${total}.\nConoces clarito quÃ© entra y quÃ© no en el EBITDA.`;

        if (typeof confetti !== "undefined") {
          confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } });
        }

      } else if (ratio >= 0.7) {
        emoji = "ðŸ˜Ž";
        title = "Â¡Muy buen resultado!";
        text = `Lo hiciste muy bien: ${score}/${total}.\nSolo unos detalles por afinar sobre EBITDA.`;

      } else if (ratio >= 0.4) {
        emoji = "ðŸ™‚";
        title = "Buen intento";
        text = `Puntos: ${score}/${total}.\nYa vas entendiendo, vale la pena revisar la definiciÃ³n y volver a jugar.`;

      } else {
        emoji = "ðŸ§ ";
        title = "Momento de aprender";
        text = `Puntos: ${score}/${total}.\nNo pasa nada, esto es justo para practicar quÃ© sÃ­ y quÃ© no cuenta en el EBITDA.`;
      }

      emojiEl.textContent = emoji;
      titleEl.textContent = title;
      textEl.textContent = text;

      overlay.classList.remove("hidden");
    }

    function restartGame() {
      // Reiniciar estado
      currentIndex = 0;
      score = 0;

      // Mezclar de nuevo el orden de las preguntas
      shuffle(questions);

      // Reset de UI
      document.getElementById("score").textContent = score;
      document.getElementById("progress-inner").style.width = "0%";
      document.getElementById("feedback").textContent =
        "Toca un botÃ³n para responder.";

      // Ocultar overlay final
      document.getElementById("final-overlay").classList.add("hidden");

      // Cargar primera pregunta
      updateUI();
    }

    // Inicializar juego
    shuffle(questions);
    updateUI();
  </script>
</body>
</html>
